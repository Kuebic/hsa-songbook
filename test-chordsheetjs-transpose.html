<!DOCTYPE html>
<html>
<head>
    <title>Test ChordSheetJS Transpose</title>
    <script src="https://unpkg.com/chordsheetjs@12.3.1/dist/chordsheetjs.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { border: 1px solid #ccc; padding: 15px; margin: 20px 0; }
        button { padding: 5px 15px; margin: 5px; }
        pre { background: #f5f5f5; padding: 10px; }
        .output { background: #e0ffe0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ChordSheetJS Transpose Test</h1>
    
    <div class="test">
        <h2>Test 1: Basic Transpose</h2>
        <pre id="input1">{title: Test Song}
{key: G}

[Verse]
[G]This is a [C]test [D]song in [G]G major</pre>
        
        <div>
            <button onclick="testTranspose(1, -2)">Transpose -2</button>
            <button onclick="testTranspose(1, -1)">Transpose -1</button>
            <button onclick="testTranspose(1, 0)">No Transpose</button>
            <button onclick="testTranspose(1, 1)">Transpose +1</button>
            <button onclick="testTranspose(1, 2)">Transpose +2</button>
        </div>
        
        <div id="output1" class="output"></div>
    </div>
    
    <div class="test">
        <h2>Test 2: Complex Chords</h2>
        <pre id="input2">{title: Complex Chords}
{key: C}

[Verse]
[Cmaj7]Major seventh [Dm7]minor seventh
[G7sus4]Suspended [C/E]slash chord</pre>
        
        <div>
            <button onclick="testTranspose(2, -1)">Transpose -1</button>
            <button onclick="testTranspose(2, 0)">No Transpose</button>
            <button onclick="testTranspose(2, 1)">Transpose +1</button>
        </div>
        
        <div id="output2" class="output"></div>
    </div>
    
    <script>
        function testTranspose(testNum, semitones) {
            const input = document.getElementById('input' + testNum).textContent;
            const outputDiv = document.getElementById('output' + testNum);
            
            try {
                // Parse the ChordPro
                const parser = new ChordSheetJS.ChordProParser();
                const song = parser.parse(input);
                
                console.log('Before transpose:', song);
                
                // Apply transposition
                if (semitones !== 0) {
                    song.transpose(semitones);
                    console.log('After transpose by', semitones, ':', song);
                }
                
                // Format back to ChordPro
                const formatter = new ChordSheetJS.ChordProFormatter();
                const output = formatter.format(song);
                
                // Also format as HTML to see the chords clearly
                const htmlFormatter = new ChordSheetJS.HtmlDivFormatter();
                const htmlOutput = htmlFormatter.format(song);
                
                outputDiv.innerHTML = `
                    <h3>Transposed by ${semitones} semitones:</h3>
                    <h4>ChordPro Output:</h4>
                    <pre>${output}</pre>
                    <h4>HTML Output:</h4>
                    <div style="background: white; padding: 10px; border: 1px solid #ddd;">
                        ${htmlOutput}
                    </div>
                `;
            } catch (error) {
                outputDiv.innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
                console.error('Transpose error:', error);
            }
        }
        
        // Test on load
        window.onload = function() {
            testTranspose(1, 0);
            testTranspose(2, 0);
        };
    </script>
</body>
</html>